<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .zui-table tbody td[data-related='1']:hover {
        background-color: red;
      }

      th,
      td {
        min-width: 100px;
        text-align: left;
        padding: 10px;
      }

      .zui-table {
        position: relative;
        z-index: 1;
      }
      .connector {
        position: absolute;
        pointer-events: none;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 0;
      }
      .connector svg {
        stroke: #cce7e7;
        stroke-width: 2px;
        fill: none;
      }
      .container {
        position: relative;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <table class="zui-table zui-table-horizontal zui-table-highlight">
        <thead>
          <tr>
            <th>Name</th>
            <th>Position</th>
            <th>Height</th>
            <th>Born</th>
            <th>Salary</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>DeMarcus Cousins</td>
            <td data-related="1">C</td>
            <td data-related="1">6'11"</td>
            <td>08-13-1990</td>
            <td data-related="1">$4,917,000</td>
          </tr>
          <tr>
            <td data-related="1">Isaiah Thomas</td>
            <td>PG</td>
            <td>5'9"</td>
            <td data-related="1">02-07-1989</td>
            <td>$473,604</td>
          </tr>
          <tr>
            <td>Ben McLemore</td>
            <td>SG</td>
            <td>6'5"</td>
            <td>02-11-1993</td>
            <td>$2,895,960</td>
          </tr>
          <tr>
            <td>Marcus Thornton</td>
            <td>SG</td>
            <td>6'4"</td>
            <td>05-05-1987</td>
            <td>$7,000,000</td>
          </tr>
          <tr>
            <td>Jason Thompson</td>
            <td>PF</td>
            <td>6'11"</td>
            <td>06-21-1986</td>
            <td>$3,001,000</td>
          </tr>
        </tbody>
      </table>

      <div class="connector">
        <svg width="100%" height="100%"></svg>
      </div>
    </div>
  </body>
</html>

<script>
  const cells = Array.from(
    document.querySelectorAll('.zui-table tbody td[data-related="1"]')
  );
  const connector = document.querySelector('.connector>svg');
  const table = document.querySelector('.zui-table');

  table.addEventListener('mouseenter', () => {
    if (cells.length < 4) return; // Ensure there are at least two cells

    // Sort cells by column index
    cells.sort((a, b) => {
      const aIndex = Array.from(a.parentNode.children).indexOf(a);
      const bIndex = Array.from(b.parentNode.children).indexOf(b);
      return aIndex - bIndex;
    });

    let points = '';
    const dataPoints = [];

    // left -> right
    cells.forEach((cell, index) => {
      const tableRect = cell.closest('.zui-table').getBoundingClientRect();

      // current cell
      const currentCell = cell;
      // current cell rect
      const currentCellRect = currentCell.getBoundingClientRect();

      // next cell
      const nextCell = cells[index + 1];

      // if next cell is not existing go to end
      if (!nextCell) {
        return;
      }
      // next cell rect
      const nextCellRect = nextCell.getBoundingClientRect();

      // cell dimensions
      const cellWidth = currentCellRect.width;
      const cellHeight = currentCellRect.height;

      // calculate next cell pos according to the current cell
      const isNextCellUp = currentCellRect.top > nextCellRect.top;
      const isNextCellEven = currentCellRect.top === nextCellRect.top;

      const gap = cellWidth * 0.1;

      // start point
      dataPoints.push({
        x: currentCellRect.left - tableRect.left,
        y: currentCellRect.top - tableRect.top,
      });

      if (isNextCellUp) {
        dataPoints.push({
          x: nextCellRect.left - tableRect.left - 2 * gap,
          y: currentCellRect.top - tableRect.top,
        });

        dataPoints.push({
          x: nextCellRect.left - tableRect.left - gap,
          y: nextCellRect.top - tableRect.top,
        });
      } else {
        dataPoints.push({
          x: nextCellRect.left - tableRect.left - gap,
          y: currentCellRect.top - tableRect.top,
        });
      }

      // end point
      dataPoints.push({
        x: nextCellRect.left - tableRect.left,
        y: nextCellRect.top - tableRect.top,
      });
    });

    // right <- left
    cells.reverse().forEach((cell, index) => {
      const tableRect = cell.closest('.zui-table').getBoundingClientRect();

      // current cell
      const currentCell = cell;
      // current cell rect
      const currentCellRect = currentCell.getBoundingClientRect();

      // cell dimensions
      const cellWidth = currentCellRect.width;
      const cellHeight = currentCellRect.height;

      // start point
      const startPointX = currentCellRect.left - tableRect.left + cellWidth;
      const startPointY = currentCellRect.top - tableRect.top + cellHeight;
      // next cell
      const nextCell = cells[index + 1];

      // if next cell is not existing go to end
      if (!nextCell) {
        return;
      }
      // next cell rect
      const nextCellRect = nextCell.getBoundingClientRect();

      // calculate next cell pos according to the current cell
      const isNextCellExist = nextCell;
      const isNextCellUp = currentCellRect.top > nextCellRect.top;
      const isNextCellEven = currentCellRect.top === nextCellRect.top;

      const gap = cellWidth * 0.15;

      // start point
      dataPoints.push({
        x: startPointX,
        y: startPointY,
      });

      if (isNextCellUp) {
        dataPoints.push({
          x: startPointX - gap,
          y: next.top - tableRect.top + cellHeight,
        });
      } else {
        dataPoints.push({
          x: startPointX - gap,
          y: currentCellRect.top - tableRect.top,
        });
        dataPoints.push({
          x: startPointX - 2 * gap,
          y: nextCellRect.top - tableRect.top + cellHeight,
        });
      }

      // end point
      dataPoints.push({
        x: currentCellRect.left - tableRect.left,
        y: startPointY,
      });
    });

    points += dataPoints.map(d => `${d.x},${d.y}`).join(' ');

    // Create a new path for each mouseenter event
    const polygon = document.createElementNS(
      'http://www.w3.org/2000/svg',
      'polygon'
    );
    polygon.setAttribute('points', points);
    polygon.setAttribute('fill', '#cce7e7');
    polygon.setAttribute('stroke-width', `1px`); // Set stroke-width to the height of the cell 38.5

    // Remove old paths before adding the new one
    while (connector.firstChild) {
      connector.removeChild(connector.firstChild);
    }

    connector.appendChild(polygon);
  });
</script>
